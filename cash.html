<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cash Diff</title>
  <style>
    :root{
      --bg:#0f1115;
      --panel:#151821;
      --panel2:#10131a;
      --text:#e7e7e7;
      --muted:#a9a9a9;
      --line:#262b36;
      --btn:#232836;
      --btn2:#1a1f2b;
      --focus:#7a7a7a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif;
      background:linear-gradient(180deg, var(--bg), #0b0d11);
      color:var(--text);
    }
    .wrap{
      max-width:720px;
      margin:0 auto;
      padding:14px 12px 18px;
    }
    .card{
      background:rgba(21,24,33,.92);
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .title h1{
      margin:0;
      font-size:18px;
      font-weight:700;
      letter-spacing:.2px;
    }
    .chip{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
      background:rgba(16,19,26,.8);
      user-select:none;
    }

    .grid{
      display:grid;
      gap:10px;
    }

    .hdr{
      display:grid;
      grid-template-columns: 84px 1fr 38px 1fr;
      gap:8px;
      align-items:center;
      padding:6px 4px 2px;
      color:var(--muted);
      font-size:12px;
    }
    .row{
      display:grid;
      grid-template-columns: 84px 1fr 38px 1fr;
      gap:8px;
      align-items:center;
    }
    .denom{
      font-size:18px;
      font-weight:700;
      color:#f0f0f0;
      padding-left:6px;
    }
    input{
      width:100%;
      font-size:20px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:var(--panel2);
      color:var(--text);
      outline:none;
    }
    input:focus{
      border-color: var(--focus);
      box-shadow: 0 0 0 3px rgba(122,122,122,.18);
    }

    .eqbtn{
      width:38px;
      height:46px;
      border-radius:14px;
      border:1px solid var(--line);
      background:linear-gradient(180deg, var(--btn), var(--btn2));
      color:var(--text);
      font-size:20px;
      font-weight:800;
      cursor:pointer;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0;
    }
    .eqbtn:active{ transform: translateY(1px); }

    .actions{
      display:flex;
      gap:10px;
      margin-top:12px;
    }
    .btn{
      flex:1;
      border:1px solid var(--line);
      background:linear-gradient(180deg, var(--btn), var(--btn2));
      color:var(--text);
      font-size:16px;
      font-weight:700;
      padding:12px 12px;
      border-radius:14px;
      cursor:pointer;
      user-select:none;
    }
    .btn.secondary{
      flex:0 0 auto;
      padding:12px 14px;
      color:var(--muted);
    }
    .btn:active{ transform: translateY(1px); }

    textarea{
      width:100%;
      margin-top:12px;
      min-height:210px;
      resize:vertical;
      font-size:15px;
      line-height:1.35;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#0b0e14;
      color:var(--text);
      outline:none;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      white-space:pre;
    }

    .small{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }

    @media (max-width:420px){
      .denom{ font-size:17px; }
      input{ font-size:19px; padding:11px 11px; }
      textarea{ font-size:14px; }
      .hdr{ grid-template-columns: 74px 1fr 34px 1fr; }
      .row{ grid-template-columns: 74px 1fr 34px 1fr; }
      .eqbtn{ width:34px; height:44px; border-radius:12px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="title">
        <h1>找零箱金額差異計算機</h1>
        <div class="chip" id="status">Ready</div>
      </div>

      <div class="hdr">
        <div></div>
        <div style="padding-left:4px;">A(系統)</div>
        <div style="text-align:center;"></div>
        <div style="padding-left:4px;">B(實際)</div>
      </div>

      <div class="grid" id="rows"></div>

      <div class="actions">
        <button class="btn" id="copyBtn">複製結果</button>
        <button class="btn secondary" id="resetBtn">清空</button>
      </div>

      <textarea id="out" readonly spellcheck="false"></textarea>

      <div class="small">
        <span>按「＝」可把 A 直接帶到 B</span>
      </div>
    </div>
  </div>

<script>
(() => {
  const denoms = [500, 100, 50, 10, 5, 1];
  const rowsEl = document.getElementById('rows');
  const outEl = document.getElementById('out');
  const statusEl = document.getElementById('status');
  const copyBtn = document.getElementById('copyBtn');
  const resetBtn = document.getElementById('resetBtn');

  const fmtMoney = (n) => {
    const sign = n < 0 ? "-" : "";
    const abs = Math.abs(n);
    return sign + "$" + abs.toLocaleString("en-US");
  };

  // LINE 友善：每行盡量短
  // 例：$500 36=36 d$0
  //     $50  25=22 d-$150
  // Totals:
  // A $22,037
  // B $21,877
  // d -$160
  const fmtLine = (denom, aQty, bQty, diffMoney) => {
    const dLabel = (diffMoney === 0) ? "d$0" : ("d" + fmtMoney(diffMoney));
    // 這裡用「$500」+ 空格 +「A=B」+ 空格 +「d...」
    // 不放逗號與長字串，避免 LINE 自動折行
    return `$${denom} ${aQty}=${bQty} ${dLabel}`;
  };

  const state = {};
  denoms.forEach(d => state[d] = { a: "", b: "" });

  function buildRows(){
    rowsEl.innerHTML = "";
    denoms.forEach(denom => {
      const row = document.createElement('div');
      row.className = "row";

      const denomEl = document.createElement('div');
      denomEl.className = "denom";
      denomEl.textContent = `$${denom}`;

      const aIn = document.createElement('input');
      aIn.inputMode = "numeric";
      aIn.placeholder = "A";
      aIn.value = state[denom].a;
      aIn.addEventListener('input', () => {
        state[denom].a = sanitize(aIn.value);
        if (aIn.value !== state[denom].a) aIn.value = state[denom].a;
        update();
      });

      const eq = document.createElement('button');
      eq.className = "eqbtn";
      eq.type = "button";
      eq.textContent = "=";
      eq.title = "把 A 複製到 B";
      eq.addEventListener('click', () => {
        state[denom].b = state[denom].a || "";
        bIn.value = state[denom].b;
        bump("A→B");
        update();
      });

      const bIn = document.createElement('input');
      bIn.inputMode = "numeric";
      bIn.placeholder = "B";
      bIn.value = state[denom].b;
      bIn.addEventListener('input', () => {
        state[denom].b = sanitize(bIn.value);
        if (bIn.value !== state[denom].b) bIn.value = state[denom].b;
        update();
      });

      row.appendChild(denomEl);
      row.appendChild(aIn);
      row.appendChild(eq);
      row.appendChild(bIn);

      rowsEl.appendChild(row);
    });
  }

  function sanitize(v){
    // 允許空字串；其他只留數字
    const s = (v ?? "").toString().replace(/[^\d]/g, "");
    // 去掉前導 0（但保留單個 0）
    if (s.length > 1) return s.replace(/^0+/, "") || "0";
    return s;
  }

  function getQty(denom, which){
    const v = state[denom][which];
    if (v === "" || v == null) return 0;
    const n = parseInt(v, 10);
    return Number.isFinite(n) ? n : 0;
  }

  function update(){
    let aTotal = 0;
    let bTotal = 0;

    const lines = [];
    lines.push("金額差異");

    denoms.forEach(denom => {
      const aQty = getQty(denom, "a");
      const bQty = getQty(denom, "b");
      const aMoney = aQty * denom;
      const bMoney = bQty * denom;
      const dMoney = bMoney - aMoney;

      aTotal += aMoney;
      bTotal += bMoney;

      lines.push(fmtLine(denom, aQty, bQty, dMoney));
    });

    const dTotal = bTotal - aTotal;
    lines.push("");
    lines.push(`系統 ${fmtMoney(aTotal)}`);
    lines.push(`實際 ${fmtMoney(bTotal)}`);
    lines.push(`差值 ${fmtMoney(dTotal)}`);

    outEl.value = lines.join("\n");
  }

  function bump(msg){
    statusEl.textContent = msg;
    clearTimeout(bump._t);
    bump._t = setTimeout(() => statusEl.textContent = "Ready", 900);
  }

  async function copyOutput(){
    const text = outEl.value || "";
    try{
      await navigator.clipboard.writeText(text);
      bump("Copied");
    }catch(e){
      // fallback
      outEl.focus();
      outEl.select();
      document.execCommand("copy");
      bump("Copied");
    }
  }

  function resetAll(){
    denoms.forEach(d => { state[d].a = ""; state[d].b = ""; });
    buildRows();
    update();
    bump("Cleared");
  }

  copyBtn.addEventListener('click', copyOutput);
  resetBtn.addEventListener('click', resetAll);

  buildRows();
  update();
})();
</script>
</body>
</html>
